	<!DOCTYPE html>
<html xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:utils="http://java.sun.com/jsf/composite/utils"
	xmlns:sec="http://www.springframework.org/security/tags"
	xmlns:p="http://primefaces.org/ui">

<h:head>
	<link href="resources/styles/main.css" rel="stylesheet" type="text/css" />
</h:head>

<h:body>
	<div id="header">
		<ui:insert name="header">
			<h:outputText value="#{loginbean.username}" />
			<ui:include src="/header.xhtml" />
		</ui:insert>
	</div>
		<div id="content">
			<ui:insert name="content">

				<p:panel header="List of Users (#{userAction.length})" styleClass="panel"
					rendered="#{request.isUserInRole('ROLE_ADMIN')}">
					<h:commandButton onclick="createDlg.show()" value="new user" styleClass="create-user" type="button"/>
					
					
					<p:dialog header="create" widgetVar="createDlg" modal="true" height="200" width="400">
						<h:form>
							username:<br/>
							<h:inputText value="#{userAction.user.username}"/><br/>
							password:<br/>
							<h:inputSecret value="#{userAction.user.password}"/><br/>
							<h:commandButton action = "#{userAction.createUser}" value="create"/>
						</h:form>
					</p:dialog>
					
					<br/>
					<ui:repeat var="usr" value="#{userAction.users}">
						<div class="user-row">
							<h:form id="show-form">
								<div style="width:100px;float:left;">
									<h:outputText value="#{usr.username}" styleClass="#{userAction.user.editable?'d':'pppp'}"/>
								</div>	
								<div style="float:left;">
									<p:commandLink action="#{userAction.editUserAction(usr)}" value="edit" process="@this" update=":edit-form" immediate="true" ajax="false">
										<f:setPropertyActionListener target="#{userAction.user}" value="#{usr}" />
									 </p:commandLink>
								</div>	
							</h:form>
						</div>		
					</ui:repeat>
									<p:ajaxStatus style="width:16px;height:16px;">
                                        <f:facet name="start">
                                            <h:graphicImage value="resources/img/ajax-loader.gif"/>
                                        </f:facet>

                                        <f:facet name="complete">
                                            <h:outputText value=""/>
                                        </f:facet>
                                    </p:ajaxStatus>
				</p:panel>

				
					<h:form id="edit-form" rendered="#{userAction.user.editable}">
					
						<p:panel header="User" styleClass="panel">
							<h:inputText value="#{userAction.user.username}"/><br/>
						</p:panel>	
						
						<p:panel header="Personal" styleClass="panel">
							first name:<h:inputText value="#{userAction.user.person.firstName}"/><br/>
							last name:<h:inputText value="#{userAction.user.person.lastName}"/><br/>
							middle name:<h:inputText value="#{userAction.user.person.middleName}"/><br/>
							DOB:<p:calendar value="#{userAction.user.person.dob}"/><br/>
						</p:panel>
						
						<ui:repeat var="emp" value="#{userAction.user.employees}">
							<p:panel header="Employee" styleClass="panel">
								state:<h:inputText value="#{emp.state}"/><br/>
							</p:panel>
						</ui:repeat>
						
						
					<p:dialog header="create" widgetVar="addEmplDlg" modal="true" height="200" width="400">
						<h:form>
							state:<br/>
							<h:inputText value="#{userAction.employee.state}"/><br/>
							<h:commandButton action = "#{userAction.addEmployee}" value="add employee"/>
						</h:form>
					</p:dialog>
						
						<h:commandButton onclick="addEmplDlg.show()" value="add employee" styleClass="create-user" type="button"/>
						
						<h:commandButton action="#{userAction.editUser}" value="ok"/>
					</h:form>	
				

				
				<p:panel header="Personal Info" rendered="#{request.isUserInRole('ROLE_USER')}">
					personal info...
				</p:panel>

			</ui:insert>
		</div>
	
	<div id="footer">
		<ui:insert name="footer">
			<ui:include src="/footer.xhtml" />
		</ui:insert>
	</div>

</h:body>
</html>