	<!DOCTYPE html>
<html xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:utils="http://java.sun.com/jsf/composite/utils"
	xmlns:sec="http://www.springframework.org/security/tags"
	xmlns:p="http://primefaces.org/ui">

<h:head>
	<link href="resources/styles/main.css" rel="stylesheet" type="text/css" />
</h:head>

<h:body>
	<div id="header">
		<ui:insert name="header">
			<h:outputText value="#{loginbean.username}" />
			<ui:include src="/header.xhtml" />
		</ui:insert>
	</div>
		<div id="content">
			<ui:insert name="content">

				<p:panel header="User" styleClass="panel"
					rendered="#{facesContext.externalContext.isUserInRole('ROLE_ADMIN')}">
					<h:commandButton onclick="createDlg.show()" value="New user" style="margin-right:20px;" type="button"/>
					
					
					<p:dialog header="create" widgetVar="createDlg" modal="true" height="200" width="400">
						<h:form>
							username:<br/>
							<h:inputText value="#{user.username}"/><br/>
							password:<br/>
							<h:inputSecret value="#{user.password}"/><br/>
							<h:commandButton action = "#{userAction.createUser}" value="create"/>
						</h:form>
					</p:dialog>
					
					<br/>
					existing users:<br/>
					<ui:repeat var="usr" value="#{userAction.users}">
						<h:form id="show-form">
							<h:outputText value="#{usr.username}"/>
							<p:commandLink action="#{userAction.editUserAction(usr)}" value="edit" process="@this" update=":edit-form" immediate="true">
								<f:setPropertyActionListener target="#{userAction.user}" value="#{usr}" />
							 </p:commandLink> 

						</h:form>
					</ui:repeat>
									<p:ajaxStatus style="width:16px;height:16px;">
                                        <f:facet name="start">
                                            <h:graphicImage value="resources/img/ajax-loader.gif"/>
                                        </f:facet>

                                        <f:facet name="complete">
                                            <h:outputText value=""/>
                                        </f:facet>
                                    </p:ajaxStatus>
				</p:panel>

					<h:form id="edit-form" rendered="#{userAction.user.editable}">
						<h:inputText value="#{userAction.user.username}"/><br/>
						
						
						<h:inputText value="#{userAction.person.firstName}"/><br/>
						<h:inputText value="#{userAction.person.lastName}"/><br/>
						<h:inputText value="#{userAction.person.middleName}"/><br/>
						<p:calendar value="#{userAction.person.dob}"/>
						
						
						<h:commandButton action="#{userAction.editUser}" value="ok"/>
					</h:form>	
				

				
				<p:panel header="Personal Info" rendered="#{facesContext.externalContext.isUserInRole('ROLE_USER')}">
					personal info...
				</p:panel>

			</ui:insert>
		</div>
	
	<div id="footer">
		<ui:insert name="footer">
			<ui:include src="/footer.xhtml" />
		</ui:insert>
	</div>

</h:body>
</html>